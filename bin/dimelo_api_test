#!/usr/bin/env ruby

require 'rubygems'
require 'bundler'
$LOAD_PATH.unshift "#{File.dirname(__FILE__)}/../lib"
require 'dimelo_api'
require 'pp'

unless ENV['DIMELO_API_KEY'].present?
  puts "Don't forget to set your api key"
  exit 1
end


users_client = Dimelo::API::Client.new('https://domain-test.api.users.dimelo.com/1.0', 'access_token' => '55d8ac94bfb93a71f1fb7ee730079e8a')
answers_client = Dimelo::API::Client.new('https://domain-test.api.answers.dimelo.com/1.0', 'access_token' => '8e82a073ff4687e21f5ef6eb11d654fe')
feedbacks_client = Dimelo::API::Client.new('https://domain-test.api.ideas.dimelo.com/1.0', 'access_token' => 'db169a2aed0947d7f6c60341e9d4ea2b')
#users_client = Dimelo::API::Client.new('https://domain-test.api.users.dimelo.com/1.0', 'access_token' => '55d8ac94bfb93a71f1fb7ee730079e8a')
#answers_client = Dimelo::API::Client.new('https://domain-test.api.answers.dimelo.com/1.0', 'access_token' => '8e82a073ff4687e21f5ef6eb11d654fe')
#feedbacks_client = Dimelo::API::Client.new('https://domain-test.api.ideas.dimelo.com/1.0', 'access_token' => 'db169a2aed0947d7f6c60341e9d4ea2b')


user = Dimelo::User.find(1, users_client)
questions = user.questions(answers_client)
puts "question count: #{questions.count}"

questions.each do |question, i|
  answers = question.answers
  puts "#{i} of #{questions.count} => answer count: #{answers.count}"
  answers.each do |answer|
    answer.question_flow_state = "lol"
  end
end

feedbacks = Dimelo::Feedback.find({ :order => 'updated_at.desc' }, feedbacks_client)
puts "feedbacks count: #{feedbacks.count}"
puts "feedbacks not by anonymous and superadmin: #{feedbacks.select{|f| f.user_id.present?}.count}"

